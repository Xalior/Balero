#!/usr/bin/python

import time
from flask import Flask, jsonify
from multiprocessing import Process, Value
import serial


app = Flask(__name__)


tasks = [
   {
      'id': 1,
      'title': u'Buy groceries',
      'description': u'Milk, Cheese, Pizza, Fruit, Tylenol', 
      'done': False
   },
   {
      'id': 2,
      'title': u'Learn Python',
      'description': u'Need to find a good Python tutorial on the web', 
      'done': False
   }
]


@app.route('/api', methods=['GET'])
def get_tasks():
   return jsonify({'tasks': tasks})


def anim_loop(anim_on):
   while True:
      if anim_on.value == True:
         print("anim running")
      time.sleep(5/1000.0)
#def rainbowCycle(strip, wait_ms=20, iterations=5):
#        """Draw rainbow that uniformly distributes itself across all pixels."""
#        for j in range(256*iterations):
#                for i in range(strip.numPixels()):
#                        strip.setPixelColor(i, wheel((int(i * 256 / strip.numPixels()) + j) & 255))
#                strip.show()
#                time.sleep(wait_ms/1000.0)

def serial_loop():
   ser = serial.Serial('/dev/ttyGS0', 115200)
   while True:
      ser.write("hello...")
      print("tick")
      time.sleep(1)

if __name__ == "__main__":
   anim_on = Value('b', True)
   p = Process(target=anim_loop, args=(anim_on,))
   p.start()  
   app.run(debug=True, use_reloader=False, host='0.0.0.0')
   p.join()
